(function(){function t(t){return document.createElementNS(u,t)}function i(t){return(t<10?"0":"")+t}function e(t){var i=++w+"";return t?t+i:i}function s(s,n){function a(t,i){var e=h.offset(),s=/^touch/.test(t.type),o=e.left+M,a=e.top+M,r=(s?t.originalEvent.touches[0]:t).pageX-o,p=(s?t.originalEvent.touches[0]:t).pageY-a,u=Math.sqrt(r*r+p*p),k=!1;if(!i||!(u<A-P||u>A+P)){t.preventDefault();var f=setTimeout(function(){c.addClass("clockpicker-moving")},200);d&&h.append(S.canvas),S.setHand(r,p,!i,!0),l.off(m).on(m,function(t){t.preventDefault();var i=/^touch/.test(t.type),e=(i?t.originalEvent.touches[0]:t).pageX-o,s=(i?t.originalEvent.touches[0]:t).pageY-a;(k||e!==r||s!==p)&&(k=!0,S.setHand(e,s,!1,!0))}),l.off(g).on(g,function(t){l.off(g),t.preventDefault();var e=/^touch/.test(t.type),s=(e?t.originalEvent.changedTouches[0]:t).pageX-o,u=(e?t.originalEvent.changedTouches[0]:t).pageY-a;(i||k)&&s===r&&u===p&&S.setHand(s,u),"hours"===S.currentView?S.toggleView("minutes",T/2):n.autoclose&&(S.minutesView.addClass("clockpicker-dial-out"),setTimeout(function(){S.done()},T/2)),h.prepend(O),clearTimeout(f),c.removeClass("clockpicker-moving"),l.off(m)})}}var r=p(C),h=r.find(".clockpicker-plate"),u=r.find(".clockpicker-hours"),k=r.find(".clockpicker-minutes"),f=r.find(".AMPMSwitch"),b="INPUT"===s.prop("tagName"),H=b?s:s.find("input"),x=s.find(".input-group-addon"),S=this;if(this.id=e("cp"),this.element=s,this.options=n,this.isAppended=!1,this.isShown=!1,this.currentView="hours",this.isInput=b,this.input=H,this.addon=x,this.popover=r,this.plate=h,this.hoursView=u,this.minutesView=k,this.amPmBlock=f,this.spanHours=r.find(".clockpicker-span-hours"),this.spanMinutes=r.find(".clockpicker-span-minutes"),this.spanAmPm=r.find(".clockpicker-span-am-pm"),n.twelvehour){var D=[].join("");p(D);p('<input type="radio" name="radioAMPM'+w+'" value="AM" id="radioAM'+w+'"style="display:none"></input><label for="radioAM'+w+'">AM</label>').on("click",function(){S.amOrPm=" AM",p("#radioAM"+w).prop("checked",!0),p("#radioPM"+w).prop("checked",!1),p(".clockpicker-span-am-pm").empty().append(" AM")}).appendTo(this.amPmBlock),p('<input type="radio" name="radioAMPM'+w+'" value="PM" id="radioPM'+w+'"style="display:none" checked="checked"></input><label for="radioPM'+w+'">PM</label>').on("click",function(){S.amOrPm=" PM",p("#radioAM"+w).prop("checked",!1),p("#radioPM"+w).prop("checked",!0),p(".clockpicker-span-am-pm").empty().append(" PM")}).appendTo(this.amPmBlock)}n.autoclose||p('<button type="button" class="btn btn-sm btn-default btn-block clockpicker-button">'+n.donetext+"</button>").click(p.proxy(this.done,this)).appendTo(r),"top"!==n.placement&&"bottom"!==n.placement||"top"!==n.align&&"bottom"!==n.align||(n.align="left"),"left"!==n.placement&&"right"!==n.placement||"left"!==n.align&&"right"!==n.align||(n.align="top"),r.addClass(n.placement),r.addClass("clockpicker-align-"+n.align),this.spanHours.click(p.proxy(this.toggleView,this,"hours")),this.spanMinutes.click(p.proxy(this.toggleView,this,"minutes")),H.on("focus.clockpicker click.clockpicker",p.proxy(this.show,this)),x.on("click.clockpicker",p.proxy(this.toggle,this));var E,I,B,z,j=p('<div class="clockpicker-tick"></div>');if(n.twelvehour)for(E=1;E<13;E+=1)I=j.clone(),B=E/6*Math.PI,z=A,I.css("font-size","120%"),I.css({left:M+Math.sin(B)*z-P,top:M-Math.cos(B)*z-P}),I.html(0===E?"00":E),u.append(I),I.on(v,a);else for(E=0;E<24;E+=1){I=j.clone(),B=E/6*Math.PI;var L=E>0&&E<13;z=L?y:A,I.css({left:M+Math.sin(B)*z-P,top:M-Math.cos(B)*z-P}),L&&I.css("font-size","120%"),I.html(0===E?"00":E),u.append(I),I.on(v,a)}for(E=0;E<60;E+=5)I=j.clone(),B=E/30*Math.PI,I.css({left:M+Math.sin(B)*A-P,top:M-Math.cos(B)*A-P}),I.css("font-size","120%"),I.html(i(E)),k.append(I),I.on(v,a);if(h.on(v,function(t){0===p(t.target).closest(".clockpicker-tick").length&&a(t,!0)}),d){var O=r.find(".clockpicker-canvas"),U=t("svg");U.setAttribute("class","clockpicker-svg"),U.setAttribute("width",V),U.setAttribute("height",V);var W=t("g");W.setAttribute("transform","translate("+M+","+M+")");var N=t("circle");N.setAttribute("class","clockpicker-canvas-bearing"),N.setAttribute("cx",0),N.setAttribute("cy",0),N.setAttribute("r",2);var X=t("line");X.setAttribute("x1",0),X.setAttribute("y1",0);var Y=t("circle");Y.setAttribute("class","clockpicker-canvas-bg"),Y.setAttribute("r",P);var q=t("circle");q.setAttribute("class","clockpicker-canvas-fg"),q.setAttribute("r",3.5),W.appendChild(X),W.appendChild(Y),W.appendChild(q),W.appendChild(N),U.appendChild(W),O.append(U),this.hand=X,this.bg=Y,this.fg=q,this.bearing=N,this.g=W,this.canvas=O}o(this.options.init)}function o(t){t&&"function"==typeof t&&t()}var c,n,a,r,p=window.jQuery,h=p(window),l=p(document),u="http://www.w3.org/2000/svg",d="SVGAngle"in window&&(a=document.createElement("div"),a.innerHTML="<svg/>",n=(a.firstChild&&a.firstChild.namespaceURI)==u,a.innerHTML="",n),k=(r=document.createElement("div").style,"transition"in r||"WebkitTransition"in r||"MozTransition"in r||"msTransition"in r||"OTransition"in r),f="ontouchstart"in window,v="mousedown"+(f?" touchstart":""),m="mousemove.clockpicker"+(f?" touchmove.clockpicker":""),g="mouseup.clockpicker"+(f?" touchend.clockpicker":""),b=navigator.vibrate?"vibrate":navigator.webkitVibrate?"webkitVibrate":null,w=0,M=100,A=80,y=54,P=13,V=2*M,T=k?350:1,C=['<div class="popover clockpicker-popover">','<div class="arrow"></div>','<div class="popover-title">','<span class="clockpicker-span-hours text-primary"></span>'," : ",'<span class="clockpicker-span-minutes"></span>','<span class="clockpicker-span-am-pm"></span>',"</div>",'<div class="popover-content">','<div class="clockpicker-plate">','<div class="clockpicker-canvas"></div>','<div class="clockpicker-dial clockpicker-hours"></div>','<div class="clockpicker-dial clockpicker-minutes clockpicker-dial-out"></div>',"</div>","<br>",'<span class="clockpicker-am-pm-block">','<div class="AMPMSwitch">',"</span>","</div>","</div>"].join("");s.DEFAULTS={default:"",fromnow:0,placement:"bottom",align:"left",donetext:"Done",autoclose:!1,twelvehour:!0,vibrate:!0},s.prototype.toggle=function(){this[this.isShown?"hide":"show"]()},s.prototype.locate=function(){var t=this.element,i=this.popover,e=t.offset(),s=t.outerWidth(),o=t.outerHeight(),c=this.options.placement,n=this.options.align,a={};switch(i.show(),c){case"bottom":a.top=e.top+o;break;case"right":a.left=e.left+s;break;case"top":a.top=e.top-i.outerHeight();break;case"left":a.left=e.left-i.outerWidth()}switch(n){case"left":a.left=e.left;break;case"right":a.left=e.left+s-i.outerWidth();break;case"top":a.top=e.top;break;case"bottom":a.top=e.top+o-i.outerHeight()}i.css(a)},s.prototype.show=function(t){if(!this.isShown){o(this.options.beforeShow);var e=this;this.isAppended||(c=p(document.body).append(this.popover),h.on("resize.clockpicker"+this.id,function(){e.isShown&&e.locate()}),this.isAppended=!0);var s=((this.input.prop("value")||this.options.default||"")+"").split(":");if("now"===s[0]){var n=new Date(+new Date+this.options.fromnow);s=[n.getHours(),n.getMinutes()]}this.hours=+s[0]||0,this.minutes=+s[1]||0,this.spanHours.html(i(this.hours)),this.spanMinutes.html(i(this.minutes)),""==this.spanAmPm.value?this.spanAmPm.html(" ??"):" AM"==this.spanAmPm.value?this.spanAmPm.html(" AM"):" PM"==this.spanAmPm.value&&this.spanAmPm.html(" PM"),this.toggleView("hours"),this.locate(),this.isShown=!0,l.on("click.clockpicker."+this.id+" focusin.clockpicker."+this.id,function(t){var i=p(t.target);0===i.closest(e.popover).length&&0===i.closest(e.addon).length&&0===i.closest(e.input).length&&e.hide()}),l.on("keyup.clockpicker."+this.id,function(t){27===t.keyCode&&e.hide()}),o(this.options.afterShow)}},s.prototype.hide=function(){o(this.options.beforeHide),this.isShown=!1,l.off("click.clockpicker."+this.id+" focusin.clockpicker."+this.id),l.off("keyup.clockpicker."+this.id),this.popover.hide(),o(this.options.afterHide)},s.prototype.toggleView=function(t,i){var e=!1;"minutes"===t&&"visible"===p(this.hoursView).css("visibility")&&(o(this.options.beforeHourSelect),e=!0);var s="hours"===t,c=s?this.hoursView:this.minutesView,n=s?this.minutesView:this.hoursView;this.currentView=t,this.spanHours.toggleClass("text-primary",s),this.spanMinutes.toggleClass("text-primary",!s),n.addClass("clockpicker-dial-out"),c.css("visibility","visible").removeClass("clockpicker-dial-out"),this.resetClock(i),clearTimeout(this.toggleViewTimer),this.toggleViewTimer=setTimeout(function(){n.css("visibility","hidden")},T),e&&o(this.options.afterHourSelect)},s.prototype.resetClock=function(t){var i=this.currentView,e=this[i],s="hours"===i,o=Math.PI/(s?6:30),c=e*o,n=s&&e>0&&e<13?y:A,a=Math.sin(c)*n,r=-Math.cos(c)*n,p=this;d&&t?(p.canvas.addClass("clockpicker-canvas-out"),setTimeout(function(){p.canvas.removeClass("clockpicker-canvas-out"),p.setHand(a,r)},t)):this.setHand(a,r)},s.prototype.setHand=function(t,e,s,o){var c,n=Math.atan2(t,-e),a="hours"===this.currentView,r=Math.PI/(a||s?6:30),h=Math.sqrt(t*t+e*e),l=this.options,u=a&&h<(A+y)/2,k=u?y:A;if(l.twelvehour&&(k=A),n<0&&(n=2*Math.PI+n),c=Math.round(n/r),n=c*r,l.twelvehour?a?0===c&&(c=12):(s&&(c*=5),60===c&&(c=0)):a?(12===c&&(c=0),c=u?0===c?12:c:0===c?0:c+12):(s&&(c*=5),60===c&&(c=0)),this[this.currentView]!==c&&b&&this.options.vibrate&&(this.vibrateTimer||(navigator[b](10),this.vibrateTimer=setTimeout(p.proxy(function(){this.vibrateTimer=null},this),100))),this[this.currentView]=c,this[a?"spanHours":"spanMinutes"].html(i(c)),d){o||!a&&c%5?(this.g.insertBefore(this.hand,this.bearing),this.g.insertBefore(this.bg,this.fg),this.bg.setAttribute("class","clockpicker-canvas-bg clockpicker-canvas-bg-trans")):(this.g.insertBefore(this.hand,this.bg),this.g.insertBefore(this.fg,this.bg),this.bg.setAttribute("class","clockpicker-canvas-bg"));var f=Math.sin(n)*k,v=-Math.cos(n)*k;this.hand.setAttribute("x2",f),this.hand.setAttribute("y2",v),this.bg.setAttribute("cx",f),this.bg.setAttribute("cy",v),this.fg.setAttribute("cx",f),this.fg.setAttribute("cy",v)}else this[a?"hoursView":"minutesView"].find(".clockpicker-tick").each(function(){var t=p(this);t.toggleClass("active",c===+t.html())})},s.prototype.done=function(){o(this.options.beforeDone),this.hide();var t=this.input.prop("value"),e=i(this.hours)+":"+i(this.minutes);this.options.twelvehour&&(e+=this.amOrPm),this.input.prop("value",e),e!==t&&(this.input.triggerHandler("change"),this.isInput||this.element.trigger("change")),this.options.autoclose&&this.input.trigger("blur"),o(this.options.afterDone)},s.prototype.remove=function(){this.element.removeData("clockpicker"),this.input.off("focus.clockpicker click.clockpicker"),this.addon.off("click.clockpicker"),this.isShown&&this.hide(),this.isAppended&&(h.off("resize.clockpicker"+this.id),this.popover.remove())},p.fn.clockpicker=function(t){var i=Array.prototype.slice.call(arguments,1);return this.each(function(){var e=p(this),o=e.data("clockpicker");if(o)"function"==typeof o[t]&&o[t].apply(o,i);else{var c=p.extend({},s.DEFAULTS,e.data(),"object"==typeof t&&t);e.data("clockpicker",new s(e,c))}})}})();
